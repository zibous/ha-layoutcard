/**
 * ha-layoutcard 0.0.4
 * https://github.com/zibous/ha-layoutcard
 * 
 * License: MIT
 * Generated on 2020
 * Author: Peter siebler
 */

"use strict";const appinfo={name:"✓ custom:cards-layout",tag:"cards-layout",version:"0.1.0",assets:"/hacsfiles/ha-layoutcard/assets/"};console.info("%c "+appinfo.name+"    %c ▪︎▪︎▪︎▪︎ Version: "+appinfo.version+" ▪︎▪︎▪︎▪︎ ","color:#FFFFFF; background:#3498db;display:inline-block;font-size:12px;font-weight:200;padding: 4px 0 4px 0","color:#2c3e50; background:#ecf0f1;display:inline-block;font-size:12px;font-weight:200;padding: 4px 0 4px 0");const cssAttr=function(t){return"number"==typeof t?t+"px":t};class CardsLayout extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this.skipRender=!1,this.entities=[],this.cards=[],this.loginfo_enabled=!1,this.readyState=!1,this.allLoaded=!1}logInfo(...t){this.logenabled&&console.info((new Date).toISOString(),appinfo.name,...t)}set hass(t){if(void 0!==t&&(this._hass=t,this.readyState)){if(!1===this.allLoaded&&(this.logInfo(appinfo.tag,appinfo.version,"ready"),this.allLoaded=!0),this.view_footer&&this.pagefooter&&(this.view_footer.innerHTML=this.pagefooter+" ⟲ "+this.localDatetime()),this.skipRender)return;this.skipRender=!0}}async setConfig(t){if(!t||!t.rows||!Array.isArray(t.rows))throw new Error("Card config incorrect");this.shadowRoot.lastChild&&this.shadowRoot.removeChild(this.shadowRoot.lastChild),this.id||(this.addCss(),this.id="LC"+Math.floor(1e3*Math.random()),this._config=Object.assign({},t),this.logenabled=this._config.logger||!1,this._config.locale=this._config.locale||navigator.language||navigator.userLanguage||"en-GB",window.loadCardHelpers&&(this.helpers=await window.loadCardHelpers()),this.pagefooter=this._config.footer||'Made with <span style="color: #e25555;">&hearts;</span> by '+appinfo.tag+" &bull; version "+appinfo.version+".",this.renderCards())}addCss(){const t=document.createElement("style");t.setAttribute("id","lc-"+this.id),t.textContent='\n        .cl-layout {\n            position: relative;\n            height:100%;\n            width:100%;\n            margin: 0 auto;\n        }\n        .cl-layout-row {\n            width: 100%;\n            margin-bottom: 3em;\n        }\n        .cl-layout-columns {\n            margin: 0 auto;\n            width: 100%;\n        }\n        .clearfix::before,\n        .clearfix::after {\n            content: " ";\n            display: table;\n        }\n        .clearfix::after {\n            content: ".";\n            visibility: hidden;\n            display: block;\n            height: 0;\n            clear: both;\n        }\n        .cl-icon {\n            vertical-align: bottom;\n            padding: 0 8px 0 0;\n            color: var(--primary-text-color);\n        }\n        .cl-layout h1,\n        .cl-layout-columns h1,\n        .cl-layout-columns h2 {\n            line-height: 1.2em;\n            white-space: nowrap;\n            overflow: hidden;\n            text-overflow: ellipsis;\n            width: 99%;\n            margin: 1.2em 0 0.5em 0;\n            color: var(--primary-text-color)\n        }\n        .cl-layout-columns p {\n            white-space: pre-wrap;\n        }\n        .cl-text {\n            margin: 0 0 2em 2em;\n        }\n        .cl-card-layer {\n            position: relative;\n            float: left;\n            margin-bottom: 1.0em;\n        }\n        .cl-cde{\n            margin-right: 2em;\n            display: block;\n            width: auto;\n            height: 95%;\n        }\n        .cl-layout-footer{\n            position:absolute;\n            bottom:0;\n            right:1em;\n            z-index:800;\n            font-weight:200;\n            font-size:0.8em;\n            width:100%;\n            text-align:right;\n            overflow: hidden;\n            text-overflow: ellipsis;\n            white-space: nowrap;\n            display: inline-block;\n            vertical-align: top;\n        }\n        @media (min-width: 481px) and (max-width: 767px) {\n            .cl-layout {\n                width: 95% !important;\n                min-width: 95% !important;\n                max-width: 95% !important;\n            }\n            .cl-card-layer {\n                float: none;\n                width: 100% !important;\n                max-width: 100% !important;\n                margin-left: 0.8em !important;\n            }\n            .cl-layout-columns h1,\n            .cl-layout-columns h2 {\n                margin: 1em 0 0.3em 0;\n            }\n            .cl-layout-columns p {\n                margin: 0.3em 0 1em 0;\n            }\n            .cl-layout-footer{\n                right:0.5em;\n                text-align:center;\n                font-size:0.75em;\n            }\n        }\n        @media (min-width: 320px) and (max-width: 480px){\n            .cl-layout {\n                width: 95% !important;\n                min-width: 95% !important;\n                max-width: 95% !important;\n            }\n            .cl-card-layer {\n                float: none;\n                width: 100% !important;\n                max-width: 100% !important;\n                margin-left: 0.8em !important;\n            }\n            .cl-layout-columns h1,\n            .cl-layout-columns h2 {\n                margin: 1em 0 0.3em 0;\n            }\n            .cl-layout-columns p {\n                margin: 0.3em 0 1em 0;\n            }\n            .cl-layout-footer{\n                right:0.3em;\n                text-align:center;\n                font-size:0.65em;\n            }\n        }\n        ',this.shadowRoot.appendChild(t)}async createCardElement(t){const e=(t,n)=>{if(this.helpers)return"divider"===n.type?this.helpers.createRowElement(n):this.helpers.createCardElement(n);const i=document.createElement(t);try{i.setConfig(n)}catch(i){return console.error(t,i),((t,n)=>e("hui-error-card",{type:"error",error:t,origConfig:n}))(i.message,n)}return i};let n=t.type,i=!0;n.startsWith("divider")?n="hui-divider-row":n.startsWith("custom:")?(n=n.substr("custom:".length),i=!1):n=`hui-${n}-card`;const o=e(n,t);return o.hass=this._hass,this.cards.push(o),o}styleCard(t,e){if(t.shadowRoot){if(t.shadowRoot.querySelector("ha-card")){let n=t.shadowRoot.querySelector("ha-card");return n.classList.add("cl-card"),e.style&&(n.style.cssText=e.style.replaceAll("\n","")),this.provideHass(t),!0}{let e=t.shadowRoot.getElementById("root");if(e||(e=t.shadowRoot.getElementById("card")),!e)return!1;e=e.childNodes;for(let t=0;t<e.length;t++)e[t].style&&e[t].classList.add("cl-card"),this.styleCard(e[t]);return!0}}{if("function"==typeof t.querySelector&&t.querySelector("ha-card")){t.querySelector("ha-card").classList.add("cl-card")}let e=t.childNodes;if(!e)return!1;for(let t=0;t<e.length;t++)e[t]&&e[t].style&&e[t].classList.add("cl-card"),this.styleCard(e[t]);return!0}}provideHass(t){return document.querySelector("hc-main")?document.querySelector("hc-main").provideHass(t):document.querySelector("home-assistant")?document.querySelector("home-assistant").provideHass(t):void 0}localDatetime(){const t=new Date;return new Intl.DateTimeFormat(this._config.locale,{year:"numeric",month:"numeric",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric"}).format(t)}async renderCards(){const t=document.createElement("div");if(t.setAttribute("class","cl-layout"),t.setAttribute("id","cl-"+this.id),this._config.width&&(t.style.width=t.style.minWidth=this._config.width),this._config.title){const e=document.createElement("h1");if(this._config.icon){const t=document.createElement("ha-icon");t.setAttribute("icon",this._config.icon),t.setAttribute("class","cl-icon"),t.style.cssText="--mdc-icon-size:36px",e.appendChild(t);const n=document.createElement("span");n.innerHTML=this._config.title,e.appendChild(n)}else e.innerHTML=this._config.title;t.append(e)}if(this._config.description){const e=document.createElement("p");e.innerHTML=this._config.description,t.append(e)}this._config.rows.forEach((e,n)=>{const i=document.createElement("div");i.setAttribute("class","cl-layout-row"),e.row.forEach((t,e)=>{const n=document.createElement("div");if(n.setAttribute("class","cl-layout-columns clearfix"),t.title){const e=document.createElement("h2");e.innerHTML=t.title,n.append(e)}if(t.description){const e=document.createElement("p");e.innerHTML=t.description,n.append(e)}let o=t.width||"100%",a=t.height||"100%",s={width:cssAttr(o),height:cssAttr(a),style:null};const r=t.entities,l=r.map(t=>this.createCardElement(t));Promise.all(l).then(t=>{t.forEach((t,e)=>{const i=r[e],a=document.createElement("div");a.setAttribute("class","cl-card-layer"),a.style.width=a.style.maxWidth=s.width||o,a.style.height=a.style.maxHeight=s.height||o,i.maxwidth&&(a.style.maxWidth=cssAttr(i.maxwidth)),i.maxheight&&(a.style.maxheight=cssAttr(i.maxheight)),t.classList.add("cl-cde"),window.setTimeout(()=>{t.updateComplete?t.updateComplete.then(()=>this.styleCard(t,i)):this.styleCard(t,i)},800),a.append(t),n.appendChild(a)})}),i.append(n)}),t.append(i)}),this.pagefooter&&""!=this.pagefooter&&(this.view_footer=document.createElement("div"),this.view_footer.setAttribute("class","cl-layout-footer"),this.view_footer.innerHTML=this.pagefooter+" ⟲ "+this.localDatetime(),t.append(this.view_footer)),this.shadowRoot.appendChild(t)}connectedCallback(){this.readyState=!0}disconnectedCallback(){this.readyState=!1}getCardSize(){return 1}}customElements.define("cards-layout",CardsLayout);